version: 2.1
setup: true
orbs:
  demo_threatrix: theatrix/demo_threatrix@dev:alpha

filters: &filters
  tags:
    only: /.*/

jobs:
  threatrix_scan:
    docker:
      - image: circleci/openjdk:11-jdk-node
    working_directory: ~/repo
    environment:
      MAVEN_OPTS: -Xmx3200m
    steps:
      - checkout 
      - demo_threatrix/install_and_scan_code:
          oid: $threatrix_oid
          eid: $threatrix_eid
          api_key: $threatrix_api_key
          dir: ./   

workflows:
  test-deploy:
    jobs:
      - threatrix_scan
      - demo_threatrix/install_and_scan_code:
          context: threatrix

